<script
	type="text/x-red"
	data-template-name="cc7e6be5-8492-701c-5d18-e1c30da2866d"
></script>
<script type="text/javascript">
	registerNode({
		serviceType: 'server',

		nodeType: 'cc7e6be5-8492-701c-5d18-e1c30da2866d',

		nodeDef: {
			category: 'General',

			defaults: {
				name: { value: '' },
			},
			devInProgress: true,
			shape: 'circle',

			inputs: 0,
			outputs: 1,

			paletteLabel: 'Pcml',

			label: function editlabel(SD) {
				let label = 'Pcml';
				if (this.name) {
					label = this.name;
				}
				return label.replace(/['"]+/g, '');
			},
			labelStyle: function () {
				return this.name ? 'node_label_italic' : '';
			},
			initdefaults: function (n, S) {
				function handleDependencies(controls, value) {
					if (controls instanceof Array) {
						for (let i = 0; i < controls.length; i++) {
							if (controls[i].action === 'required') {
								if (
									(controls[i].equal &&
										controls[i].equal.to_values.includes(
											value
										)) ||
									(controls[i].notEqual &&
										!controls[
											i
										].notEqual.to_values.includes(value))
								) {
									$('#' + controls[i].id)[controls[i].type](
										'required'
									);
									n._def.defaults[
										controls[i].property
									].required = true;
								} else {
									$('#' + controls[i].id)[controls[i].type](
										'resetRequired'
									);
									n._def.defaults[
										controls[i].property
									].required = false;
								}
							} else if (controls[i].action === 'hidden') {
								if (
									(controls[i].equal &&
										controls[i].equal.to_values.includes(
											value
										)) ||
									(controls[i].notEqual &&
										!controls[
											i
										].notEqual.to_values.includes(value))
								) {
									$('#' + controls[i].id)[controls[i].type](
										'hide'
									);
									$('#' + controls[i].id)
										.closest('.editor-form-row')
										.hide();
									S.defaults.excludeFromValidation(
										n,
										controls[i].property
									);
								} else {
									$('#' + controls[i].id)
										.closest('.editor-form-row')
										.show();
									$('#' + controls[i].id)[controls[i].type](
										'show'
									);
									S.defaults.includeForValidation(
										n,
										controls[i].property
									);
								}
								S.defaults.validateForm(true);
							}
						}
					}
				}
				return Object.assign(this, {
					fileUpload: {
						attrDef: {
							options: { multifile: false, required: true },
							attrType: 'FILE_UPLOAD',
							label: 'File Upload',
						},
						validate: (v) =>
							v &&
							Array.isArray(v.configFiles) &&
							v.configFiles.length,
						value: null,
						required: true,
					},
				});
			},
		},
	});
</script>
